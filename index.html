<!DOCTYPE html>
<html>
<head>
	<title>chat-app</title>
</head>
<body>
	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-app.js"></script>
	<!-- include firebase database -->
	<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-database.js"></script>




	<!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->

	<script>
 		 // Your web app's Firebase configuration
  		 var firebaseConfig = {
   		 apiKey: "AIzaSyBbBqtvrPVvdc-cGm6-6DKnlJbjqUSjm1w",
   		 authDomain: "my-test-project-5ae73.firebaseapp.com",
   		 projectId: "my-test-project-5ae73",
   		 storageBucket: "my-test-project-5ae73.appspot.com",
   		 messagingSenderId: "650211893013",
   		 appId: "1:650211893013:web:c8d1b0c1f80b64407b531c"
  		};
  		// Initialize Firebase
   		firebase.initializeApp(firebaseConfig);

  		var myName = prompt("Enter your name");
  		function sendMessage() {
  		  //get message
  		  var message = document.getElementById("message").value;
		
    		//save in datadase
  		firebase.datadase().ref("messages").push().set({
  		"sender": myName,
  		"message": message,
  		 });

   		 //prevent form form submitting
   		 return false;
  		}
	</script>

		<!-- create a form to send message -->
		<form onsubmit="return sendMessage();">
		  <input id="message" placeholder="Enter message" autocomplete="off">
		  <input type="submit">
		</form>
		<!-- create a list -->
	<ul id="messages"></ul>

	<script type="text/javascript">
	  	//listen for incoming messages
	  	firebase.database().ref("messages").on("child_added", function (snapshot){
	   	var html = "";
	   	 //give each message a unique id
 	   	html +="<li id='message-" + snapshot.key + "'>";
 	   	//show delete buttton if message is sent by  me
 	   	if (snapshot.val().sender == myName) {
  	   	html +="<buttton data-id='" + snapshot.key + "'onclick='deleteMessage(this);'>";  
  	    	html += "Delete";
  	    	html += "<button>";
  	  	}
    		html += snapshot.val().sender + ":" + snapshot.val().message;
    		html += "</li>";
    		document.getElementById("messages").innerHTML += html;


    		function deleteMessage(self){
    		  //get message id
    		  var messageId = self.getAttribute(data-id);
		
    		  //delete message
    		  firebase.database().ref("messages").child(messageId).remove();

    		}

    		//attach listener for delete messge 
    		firebase.database().ref("messages").on("child_removed", function (snapshot){
    		//remove message node
    		document.getElementById("message-" + snapshot.key).innerHTML = "This message has been removed";
		
   		});
	</script>




</body>
</html>	
